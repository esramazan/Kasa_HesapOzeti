

CREATE VIEW [dbo].[ONE_V_001_KASA_EKSTRESI] AS
SELECT (SELECT CODE FROM ONE_001_KSCARD WHERE LOGICALREF=CARDREF)[Kasa_Kodu],
(SELECT [NAME] FROM ONE_001_KSCARD WHERE LOGICALREF=CARDREF)[Kasa_Adi], 
FICHENO[FisNo],convert(varchar,DATE_,104)[FisTarihi],case when TRCODE=11 THEN 'CH Tahsilat' else 'CH Ã–deme' end [FisTuru],
('FN:'+FICHENO+' '+ISNULL((SELECT DEFINITION_ FROM ONE_001_CLCARD WHERE CODE=CLCODE),'')+', '+KSL.GENEXP) [Detay_Aciklama],
CASE WHEN TRCODE=11 THEN 
(CASE WHEN KS.TRCURR IN (0,160) THEN AMOUNT ELSE TRNET END) else 0 END [Tahsilatlar],
CASE WHEN TRCODE=12 THEN 
(CASE WHEN KS.TRCURR IN (0,160) THEN AMOUNT ELSE TRNET END) else 0 END [Odemeler],
ISNULL((SELECT CURCODE FROM ONE_CURRENCYLIST WHERE KS.TRCURR=CURTYPE ),'TL')[Birimi]
FROM ONE_001_KSLINES KSL LEFT JOIN ONE_001_KSCARD KS ON KS.LOGICALREF=KSL.CARDREF where ksl.CANCELLED=0




